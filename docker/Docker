# syntax=docker/dockerfile:1.5

ARG BASE_IMAGE
FROM ${BASE_IMAGE}

ENV APP_HOME=/app \
    PYTHONUNBUFFERED=1 \
    RUNPOD_HANDLER=handler.handler

WORKDIR ${APP_HOME}

COPY runtime/run_alphafold.sh runtime/handler.py runtime/download_models.sh ${APP_HOME}/

RUN chmod +x ${APP_HOME}/run_alphafold.sh ${APP_HOME}/download_models.sh

COPY sample_data ${APP_HOME}/sample_data

ENV ALPHAFOLD_DIR=/opt/alphafold \
    ALPHAFOLD_DB_PATH=/data/alphafold \
    ALPHAFOLD_MODELS_DIR=/data/alphafold/models \
    ALPHAFOLD_OUTPUT=/outputs \
    PATH=${VENV_PATH}/bin:${PATH}

RUN mkdir -p ${ALPHAFOLD_OUTPUT}

EXPOSE 8000

ENTRYPOINT ["python3", "-u", "/app/handler.py"]
